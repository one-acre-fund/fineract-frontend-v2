<div class="container">

  <mat-card>

    <form [formGroup]="editChargeForm" (ngSubmit)="submit()">

      <mat-card-content>

        <div fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

          <mat-form-field fxFlex="48%">
            <mat-label>Country</mat-label>
            <mat-select placeholder="Search" #country required formControlName="country">
              <mat-select-filter *ngIf="country.focused" [array]="countries"
                (filteredReturn)="countriesDataSliced=$event" [displayMember]="'name'">
              </mat-select-filter>
              <mat-option *ngFor="let country of countries" [value]="country.id" [class.hide]="!isFiltered(country)">
                {{country.name}}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="editChargeForm.controls.country.hasError('required')">
              Country is <strong>required</strong>
            </mat-error>
          </mat-form-field>

          <mat-divider [inset]="true"></mat-divider>

          <div *ngIf="editChargeForm.controls.country.value" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%"
            fxLayout.lt-md="column">

            <mat-form-field fxFlex="48%">
              <mat-label>Charge Name</mat-label>
              <input matInput required formControlName="name">
              <mat-error *ngIf="editChargeForm.controls.name.hasError('required')">
                Charge Name is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="48%">
              <mat-label>Currency</mat-label>
              <mat-select required formControlName="currencyCode">
                <mat-option *ngFor="let currency of chargeData.currencyOptions" [value]="currency.code">
                  {{ currency.name }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="editChargeForm.controls.currencyCode.hasError('required')">
                Currency is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="48%">
              <mat-label>Charge Time Type</mat-label>
              <mat-select required formControlName="chargeTimeType" (selectionChange)="this.showPenalty=!this.showPenalty;">
                <mat-option *ngFor="let chargeTimeType of chargeData.loanChargeTimeTypeOptions" [value]="chargeTimeType.id">
                  {{ chargeTimeType.value }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="editChargeForm.controls.chargeTimeType.hasError('required')">
                Charge Time Type is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="48%">
              <mat-label>Charge Calculation Type</mat-label>
              <mat-select required formControlName="chargeCalculationType">
                <mat-option *ngFor="let chargeCalculationType of chargeData.loanChargeCalculationTypeOptions"
                  [value]="chargeCalculationType.id">
                  {{ chargeCalculationType.value }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="editChargeForm.controls.chargeCalculationType.hasError('required')">
                Charge Calculation Type is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="48%">
              <mat-label>Amount</mat-label>
              <input matInput required formControlName="amount">
              <mat-error *ngIf="editChargeForm.controls.amount.hasError('required')">
                Amount is <strong>required</strong>
              </mat-error>
              <mat-error *ngIf="editChargeForm.controls.amount.hasError('pattern') && currencyDecimalPlaces !== undefined">
                Amount must be <strong>a positive number with {{ currencyDecimalPlaces ? 'up to ' +
                  currencyDecimalPlaces : 'no' }} decimal places</strong>
              </mat-error>
              <mat-error *ngIf="editChargeForm.controls.amount.hasError('pattern') && currencyDecimalPlaces === undefined">
                Amount must be <strong>a positive number</strong>
              </mat-error>
            </mat-form-field>

            <div fxFlex="48%" fxLayout="row" fxLayoutGap="2%" fxLayout.lt-md="column">
              <div fxFlex="50%" class="active-wrapper">
                <mat-checkbox labelPosition="before" formControlName="active">
                  Active
                </mat-checkbox>
              </div>

              <div fxFlex="50%" class="penalty-wrapper" *ngIf="editChargeForm.controls.chargeTimeType.value !=1">
                <mat-checkbox labelPosition="before" formControlName="penalty">
                  Is Penalty
                </mat-checkbox>
              </div>
            </div>

          </div>

        </div>

      </mat-card-content>

      <mat-card-actions fxLayout="row" fxLayout.xs="column" fxLayoutAlign="center" fxLayoutGap="5px">
        <button type="button" mat-raised-button [routerLink]="['../']">Cancel</button>
        <button mat-raised-button color="primary" [disabled]="!editChargeForm.valid"
          *mifosxHasPermission="'UPDATE_CHARGE'">Submit</button>
      </mat-card-actions>

    </form>

  </mat-card>

</div>